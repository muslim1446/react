import{r as s,j as n,f as Ae,S as N,s as ke,K as je,T as M,g as ee,c as Re,G as Le,A as Ne,u as Oe,U as De,C as Me,B as Be,a as Pe}from"./f1a2b3c4d5exa-MAoiXiSL.js";const he=s.createContext(null);function Ve({children:e}){const[t,r]=s.useState({chapters:[],translations:{},reciters:{},loaded:!1,error:null});return s.useEffect(()=>{let a=!1;async function i(){try{const l=await Ae();if(a)return;r({chapters:l.streamprotectedtrack_cee2||[],translations:l.translations||{},reciters:l.streamprotectedlicense_artists_cr1||{},loaded:!0,error:null})}catch(l){if(a)return;console.error("[ConfigContext] Failed to load config:",l),r(d=>({...d,error:l.message}))}}return i(),()=>{a=!0}},[]),n.jsx(he.Provider,{value:t,children:e})}function $(){const e=s.useContext(he);if(!e)throw new Error("useConfig must be used within ConfigProvider");return e}const me=s.createContext(null),He=["en","ar","es","fr","he","zh"],Ue=["ar","he"],te="en";function Fe(){const e=window.location.pathname.split("/").filter(Boolean);return e.length>0&&He.includes(e[0])?e[0]:te}function qe(e,t){return t.split(".").reduce((r,a)=>r&&r[a]!==void 0?r[a]:null,e)}function ze({children:e}){const[t,r]=s.useState(Fe),[a,i]=s.useState({}),[l,d]=s.useState(!1),u=Ue.includes(t)?"rtl":"ltr";s.useEffect(()=>{let h=!1;async function p(){try{const c=await fetch(`/locales/${t}.json`);if(!c.ok){if(t!==te){const x=await fetch(`/locales/${te}.json`);x.ok&&!h&&(i(await x.json()),d(!0))}return}if(h)return;const y=await c.json();i(y),d(!0)}catch(c){console.error("[I18n] Failed to load translations:",c)}}return document.documentElement.lang=t,document.documentElement.dir=u,p(),()=>{h=!0}},[t,u]);const m=s.useCallback((h,p={})=>{let c=qe(a,h);return c==null||typeof c!="string"?h:(Object.entries(p).forEach(([y,x])=>{c=c.replace(new RegExp(`\\{\\{${y}\\}\\}`,"g"),x)}),c)},[a]);return n.jsx(me.Provider,{value:{locale:t,setLocale:r,t:m,dir:u,loaded:l,translations:a},children:e})}function W(){const e=s.useContext(me);if(!e)throw new Error("useI18n must be used within I18nProvider");return e}function $e(e,t,r,a,i){const l=[e,t,r,a,i||""].join("|");return btoa(l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function We(e){if(!e)return null;try{let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";const a=atob(t).split("|");return{chapter:parseInt(a[0],10)||1,verse:parseInt(a[1],10)||1,reciter:a[2]||"",translation:a[3]||"",audioTranslation:a[4]||""}}catch(t){return console.error("[StreamCodec] Decode error:",t),null}}function Ke(e){const t=$e(e.chapter,e.verse,e.reciter,e.translation,e.audioTranslation),r=new URL(window.location.href);r.searchParams.set("stream",t),window.history.replaceState({},"",r.toString())}function Ye(){const e=new URL(window.location.href),t=e.searchParams.get("stream");if(t)return We(t);const r=e.searchParams.get("streamprotectedtrack_c-ee2");return r?{chapter:parseInt(r,10)||1,verse:1,reciter:"",translation:"",audioTranslation:""}:null}const pe=s.createContext(null),Ge={chapterIndex:0,verseIndex:0,reciterId:"",translationId:"",audioTranslationId:"",view:"dashboard",isPlaying:!1,isBuffering:!1,isIdle:!1,captionText:"",captionChunks:[],currentChunkIndex:0,translationText:"",currentChapterName:"",currentVerseCount:0,mode0:!1},g={SET_CHAPTER:"SET_CHAPTER",SET_VERSE:"SET_VERSE",SET_RECITER:"SET_RECITER",SET_TRANSLATION:"SET_TRANSLATION",SET_AUDIO_TRANSLATION:"SET_AUDIO_TRANSLATION",SET_VIEW:"SET_VIEW",SET_PLAYING:"SET_PLAYING",SET_BUFFERING:"SET_BUFFERING",SET_IDLE:"SET_IDLE",SET_CAPTION_TEXT:"SET_CAPTION_TEXT",SET_CAPTION_CHUNKS:"SET_CAPTION_CHUNKS",SET_CURRENT_CHUNK:"SET_CURRENT_CHUNK",SET_TRANSLATION_TEXT:"SET_TRANSLATION_TEXT",SET_CHAPTER_META:"SET_CHAPTER_META",SET_MODE0:"SET_MODE0",RESTORE_STATE:"RESTORE_STATE",NEXT_VERSE:"NEXT_VERSE"};function Xe(e,t){switch(t.type){case g.SET_CHAPTER:return{...e,chapterIndex:t.payload,verseIndex:0};case g.SET_VERSE:return{...e,verseIndex:t.payload};case g.SET_RECITER:return{...e,reciterId:t.payload};case g.SET_TRANSLATION:return{...e,translationId:t.payload};case g.SET_AUDIO_TRANSLATION:return{...e,audioTranslationId:t.payload};case g.SET_VIEW:return{...e,view:t.payload};case g.SET_PLAYING:return{...e,isPlaying:t.payload};case g.SET_BUFFERING:return{...e,isBuffering:t.payload};case g.SET_IDLE:return{...e,isIdle:t.payload};case g.SET_CAPTION_TEXT:return{...e,captionText:t.payload};case g.SET_CAPTION_CHUNKS:return{...e,captionChunks:t.payload,currentChunkIndex:0};case g.SET_CURRENT_CHUNK:return{...e,currentChunkIndex:t.payload};case g.SET_TRANSLATION_TEXT:return{...e,translationText:t.payload};case g.SET_CHAPTER_META:return{...e,currentChapterName:t.payload.name||"",currentVerseCount:t.payload.verseCount||0};case g.SET_MODE0:return{...e,mode0:t.payload};case g.RESTORE_STATE:return{...e,...t.payload};case g.NEXT_VERSE:if(e.verseIndex+1<e.currentVerseCount)return{...e,verseIndex:e.verseIndex+1};const r=(e.chapterIndex+1)%114;return{...e,chapterIndex:r,verseIndex:0};default:return e}}function Je({children:e}){const[t,r]=s.useReducer(Xe,Ge,a=>{const i=Ye();if(i)return{...a,chapterIndex:(i.chapter||1)-1,verseIndex:(i.verse||1)-1,reciterId:i.reciter||"",translationId:i.translation||"",audioTranslationId:i.audioTranslation||""};try{const l=localStorage.getItem(N.PLAYER_STATE);if(l){const d=JSON.parse(l);return{...a,chapterIndex:d.chapterIndex||0,verseIndex:d.verseIndex||0,reciterId:d.reciterId||"",translationId:d.translationId||"",audioTranslationId:d.audioTranslationId||""}}}catch{}return a});return s.useEffect(()=>{const a={chapterIndex:t.chapterIndex,verseIndex:t.verseIndex,reciterId:t.reciterId,translationId:t.translationId,audioTranslationId:t.audioTranslationId};try{localStorage.setItem(N.PLAYER_STATE,JSON.stringify(a))}catch{}},[t.chapterIndex,t.verseIndex,t.reciterId,t.translationId,t.audioTranslationId]),s.useEffect(()=>{document.body.classList.toggle("_de",t.mode0)},[t.mode0]),s.useEffect(()=>{document.body.classList.toggle("idle",t.isIdle)},[t.isIdle]),n.jsx(pe.Provider,{value:{state:t,dispatch:r,ActionTypes:g},children:e})}function B(){const e=s.useContext(pe);if(!e)throw new Error("usePlayer must be used within PlayerProvider");return e}function Qe(){const[e,t]=s.useState(!1);return s.useEffect(()=>{window.showPageTransition=()=>t(!0),window.hidePageTransition=()=>t(!1);function r(){t(!1)}return window.addEventListener("popstate",r),window.addEventListener("pageshow",r),()=>{window.removeEventListener("popstate",r),window.removeEventListener("pageshow",r)}},[]),n.jsx("div",{id:"_m",className:e?"active":""})}function Ze(){const[e,t]=s.useState(""),[r,a]=s.useState(!1),i=s.useRef(null),l=s.useCallback(()=>{e.trim().length>0&&window.openSearch&&window.openSearch(e.trim())},[e]),d=s.useCallback(u=>{u.key==="Enter"&&l()},[l]);return n.jsxs("div",{id:"_j",children:[n.jsxs("div",{className:`_ak${r?" _df":""}`,children:[n.jsx("div",{className:"_2"}),n.jsx("input",{type:"text",id:"_cz",placeholder:"Search anything",autoComplete:"off",value:e,onChange:u=>t(u.target.value),onKeyDown:d,ref:i})]}),n.jsx("button",{id:"_bx",className:"_b0",onClick:l,children:n.jsx("span",{className:"_et","data-key":"Enter",children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:n.jsx("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})})})})]})}function et(){const{state:e,dispatch:t}=B(),{t:r}=W(),a=s.useCallback(()=>{t({type:g.SET_VIEW,payload:"dashboard"})},[t]),i=s.useCallback(()=>{window.openSearch&&window.openSearch()},[]),l=e.view==="dashboard";return n.jsxs("nav",{id:"_d8",children:[n.jsxs("a",{id:"_en",className:`_eu${l?" active":""}`,tabIndex:1,onClick:a,"data-i18n":"nav.home",role:"button",children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),n.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),n.jsx("span",{children:r("nav.home")||"Home"})]}),n.jsxs("a",{id:"_dn",className:"_eu",tabIndex:2,onClick:i,"data-i18n":"nav.search",role:"button",children:[n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("circle",{cx:"11",cy:"11",r:"8"}),n.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),n.jsx("span",{children:r("nav.search")||"Search"})]}),n.jsxs("a",{id:"_dg",className:"_eu",tabIndex:3,href:"../","data-i18n":"nav.profile",children:[n.jsx("div",{children:"Q"}),n.jsx("span",{children:r("nav.profile")||"Profile"})]})]})}function tt(){const[e,t]=s.useState(!1),[r,a]=s.useState(""),[i,l]=s.useState([]),[d,u]=s.useState(!1),{chapters:m}=$(),{dispatch:h}=B(),{t:p}=W(),c=s.useRef(null);s.useEffect(()=>{window.openSearch=f=>{t(!0),f&&a(f)},window.closeSearch=()=>t(!1)},[]),s.useEffect(()=>{if(r.length<=2){l([]);return}return clearTimeout(c.current),c.current=setTimeout(async()=>{u(!0);try{const f=await ke(r);if(f&&Array.isArray(f))l(f.filter(o=>o>=1&&o<=114));else if(f&&f.streamprotectedtrack_cee2){const o=Array.isArray(f.streamprotectedtrack_cee2)?f.streamprotectedtrack_cee2:[f.streamprotectedtrack_cee2];l(o.filter(v=>v>=1&&v<=114))}}catch(f){console.error("[Search] Error:",f)}finally{u(!1)}},500),()=>clearTimeout(c.current)},[r]);const y=s.useCallback(f=>{a(f==="SPACE"?o=>o+" ":f==="DEL"?o=>o.slice(0,-1):f==="CLEAR"?"":o=>o+f.toLowerCase())},[]),x=s.useCallback(f=>{t(!1),h({type:g.SET_CHAPTER,payload:f-1}),h({type:g.SET_VIEW,payload:"cinema"})},[h]),w=s.useCallback(()=>{if(!("webkitSpeechRecognition"in window||"SpeechRecognition"in window))return;const f=window.SpeechRecognition||window.webkitSpeechRecognition,o=new f;o.lang="en-US",o.onresult=v=>{const E=v.results[0][0].transcript;a(E)},o.start()},[]);return s.useEffect(()=>{if(!e)return;function f(o){o.key==="Escape"&&t(!1)}return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[e]),n.jsxs("div",{id:"_bj",className:e?"active":"",children:[n.jsxs("div",{className:"_a0",children:[n.jsx("button",{id:"_a1",role:"button",tabIndex:0,"data-i18n-aria-label":"search.voiceSearch",onClick:w,children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),n.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),n.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),n.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),n.jsx("div",{id:"_t",children:r||"Type to search..."}),n.jsx("div",{id:"_cc",className:"_cc",children:je.map(f=>n.jsx("button",{className:"_key",onClick:()=>y(f),tabIndex:0,children:f},f))})]}),n.jsxs("div",{className:"_a5",children:[n.jsx("h3",{children:p("search.topResults")||"Top Results"}),n.jsxs("div",{id:"_5",children:[d&&n.jsx("div",{className:"_bl"}),!d&&i.length===0&&r.length>2&&n.jsx("p",{children:"Use the keyboard to describe a topic..."}),i.map(f=>{const o=m[f-1];return o?n.jsxs("div",{className:"_dw",tabIndex:0,role:"button",onClick:()=>x(f),children:[n.jsx("div",{className:"_c5",children:f}),n.jsx("div",{className:"_dz",children:n.jsx("span",{className:"_d1",children:o.english_name||`Chapter ${f}`})})]},f):null})]})]})]})}function nt(){const{state:e}=B(),{chapters:t}=$(),{t:r}=W(),[a,i]=s.useState(""),[l,d]=s.useState(""),[u,m]=s.useState("");return s.useEffect(()=>{if(t.length>0&&e.chapterIndex<t.length){const h=t[e.chapterIndex],p=h.english_name||"";i(p),d(h.description||"");try{localStorage.setItem(N.SAVED_H1,p)}catch{}}},[t,e.chapterIndex]),s.useEffect(()=>{const h=localStorage.getItem(N.SAVED_H1);h&&!a&&i(h)},[]),n.jsxs("div",{className:"_c3",children:[n.jsx("div",{className:"_af",children:u&&n.jsx("img",{id:"_c7",src:u,alt:""})}),n.jsx("div",{className:"_1"}),n.jsxs("div",{className:"_cm",children:[n.jsx("h1",{className:"_bf",id:"_bg","data-i18n":"hero.title",children:a}),n.jsx("div",{className:"_b4",id:"_aa","data-i18n":"hero.subtitle",children:l})]})]})}function ue({id:e,cardIndices:t,chapters:r,onCardClick:a,t:i}){const l=s.useRef(null),d=s.useRef(null);s.useEffect(()=>{const h=l.current;if(!h)return;function p(c){Math.abs(c.deltaY)>Math.abs(c.deltaX)&&(c.preventDefault(),h.scrollLeft+=c.deltaY)}return h.addEventListener("wheel",p,{passive:!1}),()=>h.removeEventListener("wheel",p)},[]),s.useEffect(()=>{const h=l.current;if(!h)return;function p(c){const y=document.activeElement;if(!h.contains(y))return;const x=Array.from(h.querySelectorAll("._dw")),w=x.indexOf(y);if(w!==-1){if(c.key==="ArrowRight"){c.preventDefault();const f=(w+1)%x.length;x[f].focus({preventScroll:!0}),x[f].scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}else if(c.key==="ArrowLeft"){c.preventDefault();const f=(w-1+x.length)%x.length;x[f].focus({preventScroll:!0}),x[f].scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})}}}return h.addEventListener("keydown",p),()=>h.removeEventListener("keydown",p)},[]);const u=s.useCallback(h=>{clearTimeout(d.current),d.current=setTimeout(()=>{},M.PREVIEW_DEBOUNCE)},[]),m=s.useCallback(()=>{clearTimeout(d.current)},[]);return!r.length||!t.length?null:n.jsx("div",{className:"_cb",id:e,ref:l,children:t.map(h=>{const p=r[h];if(!p)return null;const c=h+1;return n.jsxs("div",{className:"_dw",tabIndex:0,role:"button",onClick:()=>a(h),onFocus:()=>u(h),onBlur:m,children:[n.jsx("div",{className:"_c5",children:c}),n.jsx("div",{className:"_dz",children:n.jsx("span",{className:"_d1",children:p.english_name||`Chapter ${c}`})})]},h)})})}function rt(){const{state:e,dispatch:t}=B(),{chapters:r,loaded:a}=$(),{t:i}=W(),l=e.view==="dashboard",d=s.useCallback(()=>{if(!r.length)return[];const h=e.chapterIndex,p=[];for(let c=Math.max(0,h-2);c<=Math.min(113,h+4);c++)p.push(c);return p},[r,e.chapterIndex]),u=s.useCallback(()=>r.length?[0,66,54,35,17,104,105,106,107,108,109,110,111,112,113].filter(p=>p<r.length):[],[r]),m=s.useCallback(h=>{t({type:g.SET_CHAPTER,payload:h}),t({type:g.SET_VIEW,payload:"cinema"})},[t]);return n.jsxs("div",{id:"_bq",className:l?"active":"",children:[n.jsx(nt,{}),n.jsx("div",{className:"_c6 _ab",id:"_a3",children:n.jsx(ue,{id:"_cu",cardIndices:d(),chapters:r,onCardClick:m,t:i})}),n.jsx("div",{className:"_c6 _b",id:"_ex_wrapper",children:n.jsx(ue,{id:"_ex",cardIndices:u(),chapters:r,onCardClick:m,t:i})})]})}function st({onEnded:e,onPlay:t,onPause:r}){const a=s.useRef(null),i=s.useRef(null),l=s.useRef(null),d=s.useRef(null),u=s.useRef(!1),m=s.useRef(0),h=s.useCallback((o,v=M.SOFT_FADE_DURATION)=>new Promise(E=>{if(!o||o.paused){E();return}clearInterval(l.current);const S=o.volume,b=20,I=v/b;let C=0;l.current=setInterval(()=>{C++;const j=C/b;o.volume=Math.max(0,S*(1-j*j)),C>=b&&(clearInterval(l.current),o.pause(),o.volume=S,E())},I)}),[]),p=s.useCallback((o,v=1,E=M.SMOOTH_ENTRY_DURATION)=>{if(!o)return;clearInterval(d.current),o.volume=0;const S=10,b=E/S;let I=0;d.current=setInterval(()=>{I++,o.volume=Math.min(v,I/S*v),I>=S&&(clearInterval(d.current),o.volume=v)},b)},[]),c=s.useCallback(async o=>{const v=o||a.current;if(v)try{p(v),await v.play(),t==null||t()}catch(E){if(E.name==="AbortError")return;const S=async()=>{try{p(v),await v.play(),t==null||t()}catch{}};v.addEventListener("canplay",S,{once:!0}),v.addEventListener("canplaythrough",S,{once:!0}),setTimeout(()=>{v.removeEventListener("canplay",S),v.removeEventListener("canplaythrough",S)},M.AUDIO_RETRY_TIMEOUT)}},[p,t]),y=s.useCallback(async o=>{const v=o||a.current;v&&(await h(v),r==null||r())},[h,r]),x=s.useCallback(async()=>{const o=a.current;o&&(o.paused?await c(o):await y(o))},[c,y]),w=s.useCallback(async(o,v=!1)=>{const E=a.current;if(E&&(E.paused||await h(E),E.src=o,E.load(),v)){const S=async()=>{if(await c(E),m.current!==0){const b=m.current;m.current=0,b>0&&b<E.duration&&(E.currentTime=b)}};E.addEventListener("canplay",S,{once:!0})}},[h,c]),f=s.useCallback(o=>{if(u.current)return;u.current=!0,setTimeout(()=>{u.current=!1},M.SEEK_COOLDOWN);const v=a.current;if(!v||!v.duration||isNaN(v.duration))return;const E=v.currentTime+o;E>=0&&E<v.duration?v.currentTime=E:E>=v.duration?(m.current=E-v.duration,e==null||e()):E<0&&(v.currentTime=0)},[e]);return s.useEffect(()=>(window.smartSeek=f,()=>{delete window.smartSeek}),[f]),s.useEffect(()=>{const o=a.current;if(!o)return;function v(){e==null||e()}return o.addEventListener("ended",v),()=>o.removeEventListener("ended",v)},[e]),s.useEffect(()=>()=>{clearInterval(l.current),clearInterval(d.current)},[]),{audioRef:a,translationAudioRef:i,play:c,pause:y,toggle:x,setSource:w,smartSeek:f,softFadeAudio:h,smoothAudioEntry:p}}const J=25;function at(){const e=s.useRef([]),t=s.useCallback(i=>{if(!i)return[""];const l=i.split(/\s+/);if(l.length<=J)return[i];const d=[];let u=[];for(let m=0;m<l.length;m++){u.push(l[m]);const h=l[m],p=/[.!?,;:\u060C\u061B\u061F]$/.test(h),c=u.length>=J-5,y=u.length>=J+5;(c&&p||y)&&(d.push(u.join(" ")),u=[])}return u.length>0&&(u.length<5&&d.length>0?d[d.length-1]+=" "+u.join(" "):d.push(u.join(" "))),d.length>0?d:[i]},[]),r=s.useCallback(()=>{e.current.forEach(i=>clearTimeout(i)),e.current=[]},[]),a=s.useCallback((i,l,d)=>{r();const u=t(i);if(u.length<=1||!l||l<=0)return d==null||d(i,0),u;const m=u.map(c=>c.split(/\s+/).length),h=m.reduce((c,y)=>c+y,0);let p=0;return u.forEach((c,y)=>{const x=m[y]/h*l*1e3,w=setTimeout(()=>{d==null||d(c,y)},p);e.current.push(w),p+=x}),u},[t,r]);return{getSmartChunks:t,playCinemaCaptions:a,clearCaptions:r}}function ot(e,t){const r=s.useRef(null),a=s.useRef(null),i=e==="cinema"?M.CINEMA_IDLE:M.DASHBOARD_IDLE,l=s.useCallback(u=>{document.body.classList.toggle("idle",u),t==null||t(u)},[t]),d=s.useCallback(()=>{l(!1),clearTimeout(r.current),clearTimeout(a.current),r.current=setTimeout(()=>{l(!0),e==="cinema"&&(a.current=setTimeout(()=>{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()},M.CINEMA_FAILSAFE))},i)},[e,i,l]);return s.useEffect(()=>{const u=["mousemove","keydown","touchstart","click"];return u.forEach(m=>window.addEventListener(m,d,{passive:!0})),d(),()=>{u.forEach(m=>window.removeEventListener(m,d)),clearTimeout(r.current),clearTimeout(a.current),l(!1)}},[d,l]),{resetIdle:d}}function it({title:e,artist:t,artwork:r,onPlay:a,onPause:i,onPrev:l,onNext:d,onSeekBackward:u,onSeekForward:m}){const h=s.useCallback(()=>localStorage.getItem(N.DISABLE_MEDIA_CONTROLS)==="true"||window.__DISABLE_MEDIA_SESSION__,[]);s.useEffect(()=>{if(!(!("mediaSession"in navigator)||h()))try{navigator.mediaSession.metadata=new MediaMetadata({title:e||"Tuwa",artist:t||"OpenTuwa",album:"Quran",artwork:r?[{src:r,sizes:"600x300",type:"image/png"}]:[]})}catch{}},[e,t,r,h]),s.useEffect(()=>{if(!("mediaSession"in navigator)||h())return;const p={play:a,pause:i,previoustrack:l,nexttrack:d,seekbackward:u,seekforward:m};return Object.entries(p).forEach(([c,y])=>{if(y)try{navigator.mediaSession.setActionHandler(c,y)}catch{}}),()=>{Object.keys(p).forEach(c=>{try{navigator.mediaSession.setActionHandler(c,null)}catch{}})}},[a,i,l,d,u,m,h])}const Q=new Map;async function ct(e,t){if(Q.has(e))return Q.get(e);const r=t[e];if(!r||!r.url)return console.error("[TranslationParser] No config for translation:",e),null;let a=r.url;if(a.startsWith("/media/data/")){const d=a.split("/media/data/")[1];a=await ee("data",d)}const{signal:i,cleanup:l}=Re(`translation-${e}`);try{const d=await fetch(a,{signal:i});if(l(),!d.ok)throw new Error(`Translation fetch failed: ${d.status}`);const u=await d.text(),h=new DOMParser().parseFromString(u,"text/xml");return Q.set(e,h),h}catch(d){return l(),d.name==="AbortError"||console.error("[TranslationParser] Load error:",d),null}}function lt(e,t,r){if(!e)return"";const a=e.querySelector(`sura[index="${t}"] aya[index="${r}"]`);return a&&a.getAttribute("text")||""}function q({id:e,wrapperId:t,items:r,value:a,onChange:i,placeholder:l,icon:d}){const[u,m]=s.useState(!1),h=s.useRef(null),p=s.useRef(null),c=r.find(o=>o.value===a),y=c?c.label:l||"Select...",x=s.useCallback(()=>{m(o=>!o)},[]),w=s.useCallback(o=>{i(o),m(!1)},[i]);s.useEffect(()=>{if(!u)return;function o(v){h.current&&!h.current.contains(v.target)&&m(!1)}return document.addEventListener("click",o),()=>document.removeEventListener("click",o)},[u]);const f=s.useCallback(o=>{var I,C,j,k;if(!u){(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),m(!0));return}if(o.key==="Escape"){o.preventDefault(),m(!1);return}const v=p.current;if(!v)return;const E=Array.from(v.querySelectorAll("._b5")),S=document.activeElement,b=E.indexOf(S);if(o.key==="ArrowDown"){o.preventDefault();const O=b<E.length-1?b+1:0;(I=E[O])==null||I.focus(),(C=E[O])==null||C.scrollIntoView({block:"center",behavior:"smooth"})}else if(o.key==="ArrowUp"){o.preventDefault();const O=b>0?b-1:E.length-1;(j=E[O])==null||j.focus(),(k=E[O])==null||k.scrollIntoView({block:"center",behavior:"smooth"})}else o.key==="Enter"&&(o.preventDefault(),b>=0&&r[b]&&w(r[b].value))},[u,r,w]);return s.useEffect(()=>{if(u&&p.current){const o=p.current.querySelector("._b5.selected");o&&o.scrollIntoView({block:"center"})}},[u]),n.jsxs("div",{id:t,className:`_k${u?" open":""}`,ref:h,onKeyDown:f,children:[n.jsxs("button",{className:"_q",tabIndex:0,onClick:x,"data-value":a,children:[d&&n.jsx("span",{className:"_c1",children:d}),n.jsx("span",{className:"_r",children:y})]}),n.jsx("div",{className:"_br",ref:p,children:r.map(o=>n.jsx("div",{className:`_b5${o.value===a?" selected":""}`,tabIndex:u?0:-1,onClick:()=>w(o.value),role:"option","aria-selected":o.value===a,children:o.label},o.value))})]})}const dt=()=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),n.jsx("path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4"})]});function ut(){const{state:e,dispatch:t}=B(),{chapters:r,reciters:a,translations:i}=$(),l=s.useMemo(()=>r.map((f,o)=>({value:String(o),label:`${o+1}. ${f.english_name||""}`})),[r]),d=s.useMemo(()=>{const f=e.currentVerseCount||7;return Array.from({length:f},(o,v)=>({value:String(v),label:`Verse ${v+1}`}))},[e.currentVerseCount]),u=s.useMemo(()=>Object.entries(a).map(([f,o])=>({value:f,label:o.name||f})),[a]),m=s.useMemo(()=>Object.entries(i).map(([f,o])=>({value:f,label:o.name||f})),[i]),h=s.useMemo(()=>[{value:"",label:"None"},{value:"en",label:"English"},{value:"id",label:"Indonesian"},{value:"es",label:"Spanish"}],[]),p=s.useCallback(f=>{t({type:g.SET_CHAPTER,payload:parseInt(f,10)})},[t]),c=s.useCallback(f=>{t({type:g.SET_VERSE,payload:parseInt(f,10)})},[t]),y=s.useCallback(f=>{t({type:g.SET_RECITER,payload:f})},[t]),x=s.useCallback(f=>{t({type:g.SET_TRANSLATION,payload:f})},[t]),w=s.useCallback(f=>{t({type:g.SET_AUDIO_TRANSLATION,payload:f})},[t]);return n.jsxs("div",{id:"_b2",children:[n.jsx(q,{wrapperId:"chapterSelectWrapper",items:l,value:String(e.chapterIndex),onChange:p,placeholder:"Chapter"}),n.jsx(q,{wrapperId:"verseSelectWrapper",items:d,value:String(e.verseIndex),onChange:c,placeholder:"Verse"}),n.jsx(q,{wrapperId:"reciterSelectWrapper",items:u,value:e.reciterId,onChange:y,placeholder:"Reciter"}),n.jsx(q,{wrapperId:"translationSelectWrapper",items:m,value:e.translationId,onChange:x,placeholder:"Translation",icon:n.jsx(dt,{})}),n.jsx(q,{wrapperId:"translationAudioSelectWrapper",items:h,value:e.audioTranslationId,onChange:w,placeholder:"Audio Translation"})]})}function ft(){const{state:e,dispatch:t}=B(),r=s.useCallback(()=>{e.verseIndex>0?t({type:g.SET_VERSE,payload:e.verseIndex-1}):e.chapterIndex>0&&t({type:g.SET_CHAPTER,payload:e.chapterIndex-1})},[e.verseIndex,e.chapterIndex,t]),a=s.useCallback(()=>{t({type:g.NEXT_VERSE})},[t]),i=e.chapterIndex===0&&e.verseIndex===0;return n.jsxs("div",{id:"cinema-nav-container",children:[n.jsx("button",{className:"cinema-nav-btn",id:"cinema-back-btn",onClick:r,disabled:i,"aria-label":"Previous verse",children:n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"15 18 9 12 15 6"})})}),n.jsx("button",{className:"cinema-nav-btn",id:"cinema-forward-btn",onClick:a,"aria-label":"Next verse",children:n.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n.jsx("polyline",{points:"9 18 15 12 9 6"})})})]})}const ht={play:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"30",height:"30",children:n.jsx("path",{d:"M8 5v14l11-7z"})}),pause:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"30",height:"30",children:n.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),forward:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"30",height:"30",children:n.jsx("path",{d:"M4 18l8.5-6L4 6v12zm9-12v12l8.5-6-8.5-6z"})}),backward:n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"30",height:"30",children:n.jsx("path",{d:"M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"})})};function mt({type:e}){return e?n.jsx("div",{id:"_3",className:"_3",children:n.jsx("div",{className:`_b1${e?" animate":""}`,children:ht[e]||null})}):null}function fe({side:e,active:t}){const r=e==="left";return n.jsxs("div",{id:r?"_4":"_v",className:`_s ${e}${t?" active":""}`,children:[n.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:r?n.jsx("path",{d:"M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"}):n.jsx("path",{d:"M4 18l8.5-6L4 6v12zm9-12v12l8.5-6-8.5-6z"})}),n.jsx("span",{children:r?"-10s":"+10s"})]})}function pt(){var ae,oe,ie;const{state:e,dispatch:t}=B(),{chapters:r,reciters:a,translations:i,loaded:l}=$(),{t:d}=W(),u=e.view==="cinema",m=s.useRef(null),h=s.useRef(null),[p,c]=s.useState(!1),[y,x]=s.useState(""),[w,f]=s.useState(!0),[o,v]=s.useState(null),[E,S]=s.useState(!1),[b,I]=s.useState(!1),{playCinemaCaptions:C,clearCaptions:j}=at(),[k,O]=s.useState(""),ve=s.useCallback(()=>{j(),t({type:g.NEXT_VERSE})},[t,j]),ye=s.useCallback(()=>{t({type:g.SET_PLAYING,payload:!0})},[t]),xe=s.useCallback(()=>{t({type:g.SET_PLAYING,payload:!1})},[t]),{audioRef:P,translationAudioRef:we,play:Ee,pause:ge,toggle:K,setSource:re,smartSeek:U}=st({onEnded:ve,onPlay:ye,onPause:xe});ot(e.view,L=>{t({type:g.SET_IDLE,payload:L})}),it({title:((ae=r[e.chapterIndex])==null?void 0:ae.english_name)||"Tuwa",artist:((oe=a[e.reciterId])==null?void 0:oe.name)||"OpenTuwa",artwork:null,onPlay:()=>Ee(),onPause:()=>ge(),onNext:()=>t({type:g.NEXT_VERSE}),onPrev:()=>t({type:g.SET_VERSE,payload:Math.max(0,e.verseIndex-1)}),onSeekForward:()=>U(10),onSeekBackward:()=>U(-10)});const Y=s.useCallback(async(L=!1)=>{var ce,le;if(!l||!r.length)return;const R=e.chapterIndex+1,D=e.verseIndex+1,Ie=String(R).padStart(3,"0"),_e=String(D).padStart(3,"0");t({type:g.SET_BUFFERING,payload:!0});try{const G=`${R}_${D}.png`;try{const F=await ee("image",G),H=p?m.current:h.current;H&&(H.src=F,c(X=>!X))}catch{}if(e.translationId&&i[e.translationId]){const F=await ct(e.translationId,i);if(F){const H=lt(F,R,D);x(H),P.current&&P.current.duration&&!isNaN(P.current.duration)?C(H,P.current.duration,X=>{O(X)}):O(H)}}const Te=`${Ie}${_e}.mp3`,Ce=await ee("audio",Te);await re(Ce,L),Ke({chapter:R,verse:D,reciter:e.reciterId,translation:e.translationId,audioTranslation:e.audioTranslationId});const de=((ce=r[e.chapterIndex])==null?void 0:ce.english_name)||"";document.title=`${de} - Verse ${D} | Tuwa`,t({type:g.SET_CHAPTER_META,payload:{name:de,verseCount:((le=r[e.chapterIndex])==null?void 0:le.verse_count)||7}})}catch(G){console.error("[CinemaPlayer] Load verse error:",G)}finally{t({type:g.SET_BUFFERING,payload:!1})}},[l,r,i,a,e.chapterIndex,e.verseIndex,e.reciterId,e.translationId,e.audioTranslationId,t,p,re,P,C]);s.useEffect(()=>{u&&l&&Y(e.isPlaying)},[e.chapterIndex,e.verseIndex,e.reciterId,e.translationId,u,l,Y]);const Se=s.useCallback(()=>{f(!1),Y(!0)},[Y]),V=s.useCallback(L=>{v(L),setTimeout(()=>v(null),600)},[]),be=s.useCallback(L=>{const R=L.touches[0].clientX,D=window.innerWidth;R<D/3?(U(-10),S(!0),V("backward"),setTimeout(()=>S(!1),600)):R>D*2/3?(U(10),I(!0),V("forward"),setTimeout(()=>I(!1),600)):(K(),V(e.isPlaying?"pause":"play"))},[U,K,e.isPlaying,V]);s.useEffect(()=>{if(!u)return;function L(R){(R.key===" "||R.key==="Enter")&&(R.preventDefault(),K(),V(e.isPlaying?"pause":"play"))}return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[u,K,e.isPlaying,V]);const se=((ie=r[e.chapterIndex])==null?void 0:ie.english_name)||"";return n.jsxs("div",{id:"_dd",className:u?"active":"",children:[n.jsx("audio",{id:"_cq",crossOrigin:"anonymous",ref:P}),n.jsx("audio",{id:"_e",crossOrigin:"anonymous",ref:we}),n.jsx(ft,{}),n.jsxs("div",{id:"_a6",onTouchStart:be,children:[n.jsx("div",{id:"_b7",children:n.jsx("h2",{id:"_az",children:se})}),n.jsxs("div",{className:"_by",children:[n.jsx("div",{className:"_1"}),e.isBuffering&&n.jsx("div",{className:"_bl"}),n.jsx("div",{id:"_dk",children:n.jsxs("div",{className:"container",children:[n.jsx("h1",{id:"_ch",children:se}),n.jsx("div",{className:"hero-shadowz-overlay"}),n.jsx("div",{className:"_l"}),n.jsx("div",{id:"_bd",children:n.jsxs("div",{id:"_be",children:[n.jsx("div",{id:"_0"}),n.jsx("img",{id:"_do",ref:m,className:p?"":"_at",width:"600",height:"300",loading:"eager",alt:""}),n.jsx("img",{id:"_bh",ref:h,className:p?"_at":"",loading:"lazy",alt:""})]})}),n.jsx("div",{id:"_au",dir:"auto",children:k||y})]})}),w&&n.jsx("button",{id:"_ek",onClick:Se,children:"Start"})]}),n.jsx(fe,{side:"left",active:E}),n.jsx(fe,{side:"right",active:b})]}),n.jsx(mt,{type:o}),n.jsx(ut,{})]})}function vt(){const[e,t]=s.useState(!1),[r,a]=s.useState(!1);s.useEffect(()=>{const l=localStorage.getItem(N.ARABIC_PREF);l?(a(!0),i(l)):(a(!0),i("no"))},[]);function i(l){const d=document.getElementById("_es");d&&(l==="yes"?d.href=d.href.replace("a1b2c3d4e5fxa","b1c2d3e4f5axa"):d.href=d.href.replace("b1c2d3e4f5axa","a1b2c3d4e5fxa"))}return s.useEffect(()=>{},[r]),s.useCallback(l=>{const d=l?"yes":"no";localStorage.setItem(N.ARABIC_PREF,d),i(d),a(!0),t(!1),window._pendingLaunchArgs&&window.launchPlayer&&(window.launchPlayer(...window._pendingLaunchArgs),delete window._pendingLaunchArgs)},[]),null}const yt=`
#status-hub {
  position: fixed;
  bottom: 80px;
  right: 20px;
  z-index: 10000;
  background: rgba(20, 20, 20, 0.85);
  backdrop-filter: blur(20px) saturate(150%);
  -webkit-backdrop-filter: blur(20px) saturate(150%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 16px 20px;
  color: #e0e0e0;
  font-family: 'Inter', system-ui, sans-serif;
  font-size: 0.85rem;
  min-width: 240px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.4s ease, transform 0.4s ease;
  pointer-events: none;
}
#status-hub.visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}
.status-hub-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #4ade80;
  margin-right: 8px;
  animation: pulse-dot 2s ease-in-out infinite;
}
@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}
.status-hub-actions {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}
.status-hub-btn {
  flex: 1;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  background: rgba(255, 255, 255, 0.05);
  color: #fff;
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.2s;
}
.status-hub-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}
`;function xt(){const[e,t]=s.useState(!navigator.onLine),[r,a]=s.useState(!1);s.useEffect(()=>{function u(){t(!1),a(!1)}function m(){t(!0),a(!1)}return window.addEventListener("online",u),window.addEventListener("offline",m),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",m)}},[]);const i=s.useCallback(()=>{window.location.reload()},[]),l=s.useCallback(()=>{a(!0)},[]),d=e&&!r;return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:yt}}),n.jsxs("div",{id:"status-hub",className:d?"visible":"",children:[n.jsxs("div",{children:[n.jsx("span",{className:"status-hub-dot"}),n.jsx("strong",{children:"System State"})]}),n.jsx("div",{style:{marginTop:"4px",color:"#aaa"},children:"Localized: Offline Mode"}),n.jsxs("div",{className:"status-hub-actions",children:[n.jsx("button",{className:"status-hub-btn",onClick:i,children:"Sync"}),n.jsx("button",{className:"status-hub-btn",onClick:l,children:"Dismiss"})]})]})]})}const T='button, a:not(._el):not(._dx), input, select, textarea, [tabindex]:not([tabindex="-1"]), .focusable, ._dw, ._eu, ._q, ._b5, ._c2, ._dl, .cinema-nav-btn',_={AUTH_MODAL:"_ah",PREMIUM:"_a7",ARABIC_MODAL:"_cy",SEARCH:"_bj",ISLAND_SEARCH:"_j",CINEMA:"_dd",DASHBOARD:"_bq",SIDEBAR:"_d8"};function A(e){if(!e||e.disabled)return!1;const t=window.getComputedStyle(e);if(t.display==="none"||t.visibility==="hidden"||t.opacity==="0")return!1;const r=e.getBoundingClientRect();return r.width>0&&r.height>0}function Z(){const e=document.querySelector("._k.open");if(e)return Array.from(e.querySelectorAll("._b5"));const t=document.getElementById(_.AUTH_MODAL);if(t&&(t.classList.contains("visible")||A(t)))return Array.from(t.querySelectorAll(T)).filter(A);const r=document.getElementById(_.PREMIUM);if(r&&A(r))return Array.from(r.querySelectorAll(T)).filter(A);const a=document.getElementById(_.ARABIC_MODAL),i=document.getElementById(_.SEARCH),l=document.getElementById(_.CINEMA),d=document.getElementById(_.DASHBOARD),u=document.getElementById(_.SIDEBAR);if(a){const w=window.getComputedStyle(a);if(w.display!=="none"&&w.visibility!=="hidden")return Array.from(a.querySelectorAll(T)).filter(A)}if(i&&i.classList.contains("active"))return Array.from(i.querySelectorAll(T)).filter(A);if(l&&l.classList.contains("active")){let w=Array.from(l.querySelectorAll(T));const f=document.getElementById("cinema-nav-container");if(f){const o=Array.from(f.querySelectorAll(T));w=w.concat(o)}return w.filter(A)}const m=document.getElementById(_.ISLAND_SEARCH),h=document.querySelector(".trojan-content"),p=m?Array.from(m.querySelectorAll(T)):[],c=h?Array.from(h.querySelectorAll(T)):[],y=d?Array.from(d.querySelectorAll(T)):[],x=u?Array.from(u.querySelectorAll(T)):[];return[...p,...x,...y,...c].filter(A)}function wt(e,t,r){const a={x:e.left+e.width/2,y:e.top+e.height/2},i={x:t.left+t.width/2,y:t.top+t.height/2};let l,d;return r==="ArrowLeft"||r==="ArrowRight"?(l=Math.abs(a.x-i.x),d=Math.abs(a.y-i.y)):(l=Math.abs(a.y-i.y),d=Math.abs(a.x-i.x)),r==="ArrowRight"&&i.x<=a.x||r==="ArrowLeft"&&i.x>=a.x||r==="ArrowDown"&&i.y<=a.y||r==="ArrowUp"&&i.y>=a.y?1/0:l+d*2.5}function Et({enabled:e=!0}={}){const t=s.useRef(null),r=s.useRef(null),a=s.useCallback(u=>{t.current=u,u.focus(),u.scrollIntoViewIfNeeded?u.scrollIntoViewIfNeeded({behavior:"smooth",block:"center"}):u.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},[]),i=s.useCallback(()=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{document.activeElement&&document.activeElement.blur(),t.current=null,r.current=null},5e3)},[]),l=s.useCallback(()=>{if(document.body.classList.contains("idle")){document.body.classList.remove("idle"),document.body.dispatchEvent(new Event("mousemove",{bubbles:!0}));const m=document.getElementById(_.CINEMA);if(m&&m.classList.contains("active"))return!0;if(t.current&&document.body.contains(t.current))t.current.focus();else{const h=Z();h.length>0&&a(h[0])}return!0}return!1},[a]),d=s.useCallback(u=>{if(l())return;const m=Z();if(!t.current||!document.body.contains(t.current)){const y=document.getElementById(_.PREMIUM);if(y&&A(y)){const w=y.querySelectorAll(T);w.length>0&&a(w[0]);return}const x=document.getElementById("_cz");x&&A(x)?a(x):m.length>0&&a(m[0]);return}const h=t.current.getBoundingClientRect();let p=null,c=1/0;for(let y=0;y<m.length;y++){const x=m[y];if(x===t.current)continue;const w=x.getBoundingClientRect(),f=wt(h,w,u);f<c&&(c=f,p=x)}p&&a(p)},[l,a]);s.useEffect(()=>{if(!e)return;function u(c){if(document.body.classList.contains("idle")){c.preventDefault(),c.stopImmediatePropagation(),l();return}if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(c.key)){const y=document.getElementById(_.CINEMA);if(y&&y.classList.contains("active")&&A(y)){const w=document.activeElement,f=!!document.querySelector("._k.open");if(c.key==="ArrowDown"){if(!f&&(!w||w===document.body)){c.preventDefault(),c.stopImmediatePropagation();let o=Array.from(y.querySelectorAll(T));const v=document.getElementById("cinema-nav-container");v&&(o=o.concat(Array.from(v.querySelectorAll(T))));const E=o.filter(A);if(E.length>0){const S=E.find(b=>b.classList.contains("_q"))||E[0];a(S),i()}return}i()}if(c.key==="ArrowUp"&&!f&&w&&w!==document.body){w.blur(),t.current=null,r.current&&clearTimeout(r.current),r.current=null;return}if(c.key==="ArrowLeft"||c.key==="ArrowRight"){const o=w&&w!==document.body&&(w.matches(T)||w.classList.contains("cinema-nav-btn"));if(f||o){i(),c.stopImmediatePropagation(),c.preventDefault(),d(c.key);return}else{c.preventDefault(),c.stopImmediatePropagation();const v=c.key==="ArrowLeft"?-10:10;window.smartSeek&&window.smartSeek(v);const E=(C,j)=>{let k=document.getElementById(C);return k||(k=document.createElement("div"),k.id=C,k.className=`_s ${j?"left":"right"}`,k.innerHTML=j?'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg><span>-10s</span>':'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6-8.5-6z"/></svg><span>+10s</span>',document.body.appendChild(k)),k},S=c.key==="ArrowLeft",I=E(S?"_4":"_v",S);if(I){I.classList.remove("active"),I.offsetWidth,I.classList.add("active"),I.dataset.timer&&clearTimeout(parseInt(I.dataset.timer));const C=setTimeout(()=>{I.classList.remove("active")},600);I.dataset.timer=C.toString()}return}}}c.stopImmediatePropagation(),c.preventDefault(),d(c.key)}if(c.key==="Enter"){const y=document.getElementById("_cz");if(document.activeElement===y){const w=document.querySelector("._b0");if(w){w.click();return}}const x=document.getElementById(_.CINEMA);x&&x.classList.contains("active")&&i()}if(c.key==="Escape"||c.key==="Backspace"){const y=document.querySelector("._k.open");if(y){y.classList.remove("open");const o=y.querySelector("._q");o&&o.focus();return}const x=document.getElementById(_.AUTH_MODAL);if(x&&x.classList.contains("visible")){window.closeAuth&&window.closeAuth();return}const w=document.getElementById(_.ARABIC_MODAL);if(w&&window.getComputedStyle(w).display!=="none")return;const f=document.querySelector(".active");if(f){const o=f.querySelector(".close-btn, .close-cinema-btn, .back-btn");o&&o.click()}}}function m(c){c.target.matches&&c.target.matches(T)&&(t.current=c.target)}window.addEventListener("keydown",u,!0),document.addEventListener("focusin",m);const h=new MutationObserver(()=>{const c=Z();c.length>0&&t.current&&!document.body.contains(t.current)&&a(c[0])});h.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]});const p=setTimeout(()=>{const c=document.getElementById(_.PREMIUM);if(c&&A(c)){const x=document.getElementById("_ao");x&&a(x);return}const y=document.getElementById(_.DASHBOARD);if(y&&y.classList.contains("active")){const x=document.getElementById("door-play-btn");x&&a(x)}},500);return()=>{window.removeEventListener("keydown",u,!0),document.removeEventListener("focusin",m),h.disconnect(),clearTimeout(p),r.current&&clearTimeout(r.current)}},[e,l,d,a,i])}const z="tuwa_session_hibernate",gt=864e5;function St(){console.log("Connection lost. Hibernating session...");const e={url:window.location.href,timestamp:Date.now(),scroll:{x:window.scrollX,y:window.scrollY},inputs:{},media:{}};document.querySelectorAll("input, textarea, select").forEach((t,r)=>{if(t.id||t.name){const a=t.id||t.name||`idx_${r}`;t.type==="checkbox"||t.type==="radio"?e.inputs[a]={type:"check",checked:t.checked}:e.inputs[a]={type:"value",value:t.value}}}),document.querySelectorAll("video, audio").forEach((t,r)=>{const a=t.id||`media_${r}`;e.media[a]=t.currentTime}),localStorage.setItem(z,JSON.stringify(e)),window.location.reload()}function bt(){const e=document.createElement("div");e.style.cssText="position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:white; padding:8px 16px; border-radius:20px; font-size:12px; font-family:sans-serif; pointer-events:none; z-index:9999; animation: fadeOut 3s forwards;",e.innerText="Session Restored",document.body.appendChild(e),setTimeout(()=>e.remove(),3e3);const t=document.createElement("style");t.innerHTML="@keyframes fadeOut { 0% {opacity:1} 80% {opacity:1} 100% {opacity:0} }",document.head.appendChild(t)}function It(){const e=localStorage.getItem(z);if(e)try{const t=JSON.parse(e);if(t.url!==window.location.href)return;if(Date.now()-t.timestamp>gt){localStorage.removeItem(z);return}console.log("Restoring Tuwa Session..."),Object.keys(t.inputs).forEach(r=>{const a=t.inputs[r],i=document.getElementById(r)||document.querySelector(`[name="${r}"]`);i&&(a.type==="check"?i.checked=a.checked:i.value=a.value)}),Object.keys(t.media).forEach(r=>{let a=document.getElementById(r);if(!a&&r.startsWith("media_")){const i=parseInt(r.split("_")[1]),l=document.querySelectorAll("video, audio");l[i]&&(a=l[i])}a&&(a.currentTime=t.media[r])}),setTimeout(()=>{window.scrollTo({top:t.scroll.y,left:t.scroll.x,behavior:"auto"}),localStorage.removeItem(z),bt()},100)}catch(t){console.error("Tuwa Restoration Error",t),localStorage.removeItem(z)}}function _t(){s.useEffect(()=>{function e(){navigator.onLine||St()}return window.addEventListener("offline",e),navigator.onLine&&It(),()=>{window.removeEventListener("offline",e)}},[])}function ne(e){if(e.nodeType===Node.TEXT_NODE)/[$£€¥]/.test(e.textContent)&&(e.textContent=e.textContent.replace(/[$£€¥]/g,""));else for(const t of e.childNodes)ne(t)}function Tt(){s.useEffect(()=>{ne(document.body);const e=new MutationObserver(t=>{t.forEach(r=>{r.addedNodes.forEach(a=>ne(a))})});return e.observe(document.body,{childList:!0,subtree:!0}),()=>e.disconnect()},[])}function Ct(){typeof window.gtag=="function"&&window.gtag("config",Le,{send_page_view:!1})}function At(){const[e,t]=s.useState(!1),{isTvMode:r}=Oe();return Et({enabled:r}),_t(),Tt(),s.useEffect(()=>{Ct()},[]),s.useEffect(()=>{const a=window.matchMedia?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768,i=!sessionStorage.getItem(N.HAS_LOADED);a&&i&&(sessionStorage.setItem(N.HAS_LOADED,"true"),t(!0))},[]),s.useEffect(()=>{r&&t(!0)},[r]),s.useEffect(()=>{window.location.href.includes("stream")&&t(!0)},[]),s.useEffect(()=>{new URL(window.location.href).searchParams.has("regex")&&document.querySelectorAll("._el").forEach(i=>{i.style.display="none"})},[]),n.jsxs(n.Fragment,{children:[n.jsx(De,{}),n.jsx(Me,{}),n.jsx(Qe,{}),n.jsx(Be,{}),!e&&n.jsx(Ze,{}),n.jsx(et,{}),n.jsx(tt,{}),n.jsx(rt,{}),n.jsx(pt,{}),n.jsx(vt,{}),n.jsx(xt,{}),n.jsx("audio",{id:"_ca",crossOrigin:"anonymous",muted:!0,preload:"none",hidden:!0,style:{display:"none"},onPlay:a=>a.target.pause(),onPlaying:a=>a.target.pause()})]})}function kt(){return n.jsx(Ne,{children:n.jsx(ze,{children:n.jsx(Ve,{children:n.jsx(Je,{children:n.jsx(At,{})})})})})}function jt(){if(window.location.hostname.includes("github.io")){const e=window.location.href.replace(/github\.io/,"pages.dev");window.location.replace(e)}}jt();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(e=>{console.error("SW registration failed:",e)})});const Rt=Pe.createRoot(document.getElementById("root"));Rt.render(n.jsx(kt,{}));
